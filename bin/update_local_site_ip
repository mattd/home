#!/bin/bash
if [ -z "$1" ]; then
    exit 1
else
    SITES_DIR="$HOME/sites"
    CACHE_FILE="$SITES_DIR/$1.ip"

    touch $CACHE_FILE

    CURRENT_IP=$(curl v4.ident.me 2>/dev/null && echo)
    OLD_IP=$(< $CACHE_FILE)

    if [ "$CURRENT_IP" = "$OLD_IP" ]; then
       exit 0
    else
        curl -u "$(< $SITES_DIR/.secrets/registrar_email):\"`
                `$(< $SITES_DIR/.secrets/registrar_password)"`
                `"https://iwantmyname.com/basicauth/ddns"`
                `"?hostname=$1&myip=$CURRENT_IP" \
                2>/dev/null

        echo $CURRENT_IP > $CACHE_FILE
    fi
fi
